# NanoGridBot 测试用例文档

## 1. 单元测试用例

### 1.1 配置管理模块 (ConfigManager)

#### TC-CONFIG-001: 加载默认配置
- **前置条件**: 无配置文件存在
- **测试步骤**:
  1. 初始化ConfigManager
  2. 调用loadConfig()
- **预期结果**: 返回默认配置对象
- **优先级**: P0

#### TC-CONFIG-002: 加载自定义配置
- **前置条件**: 存在有效的config.json文件
- **测试步骤**:
  1. 创建包含自定义参数的config.json
  2. 初始化ConfigManager
  3. 调用loadConfig()
- **预期结果**: 返回合并后的配置对象
- **优先级**: P0

#### TC-CONFIG-003: 配置验证失败
- **前置条件**: 存在无效的config.json文件
- **测试步骤**:
  1. 创建包含无效参数的config.json
  2. 初始化ConfigManager
  3. 调用loadConfig()
- **预期结果**: 抛出配置验证错误
- **优先级**: P1

### 1.2 数据采集模块 (DataCollector)

#### TC-DATA-001: 采集电网数据
- **前置条件**: 模拟器正常运行
- **测试步骤**:
  1. 初始化DataCollector
  2. 调用collectData()
- **预期结果**: 返回包含电压、电流、功率等数据的对象
- **优先级**: P0

#### TC-DATA-002: 数据采集超时
- **前置条件**: 模拟器无响应
- **测试步骤**:
  1. 初始化DataCollector
  2. 设置超时时间为1秒
  3. 调用collectData()
- **预期结果**: 抛出超时错误
- **优先级**: P1

#### TC-DATA-003: 数据格式验证
- **前置条件**: 模拟器返回异常数据
- **测试步骤**:
  1. 初始化DataCollector
  2. 模拟器返回格式错误的数据
  3. 调用collectData()
- **预期结果**: 抛出数据格式错误
- **优先级**: P1

### 1.3 决策引擎模块 (DecisionEngine)

#### TC-DECISION-001: 正常运行决策
- **前置条件**: 电网数据正常
- **测试步骤**:
  1. 初始化DecisionEngine
  2. 输入正常范围内的电网数据
  3. 调用makeDecision()
- **预期结果**: 返回"maintain"决策
- **优先级**: P0

#### TC-DECISION-002: 过载保护决策
- **前置条件**: 电网负载超过阈值
- **测试步骤**:
  1. 初始化DecisionEngine
  2. 输入负载超过90%的数据
  3. 调用makeDecision()
- **预期结果**: 返回"reduce_load"决策
- **优先级**: P0

#### TC-DECISION-003: 电压异常决策
- **前置条件**: 电压超出正常范围
- **测试步骤**:
  1. 初始化DecisionEngine
  2. 输入电压异常的数据
  3. 调用makeDecision()
- **预期结果**: 返回"adjust_voltage"决策
- **优先级**: P0

### 1.4 执行器模块 (Executor)

#### TC-EXEC-001: 执行维持命令
- **前置条件**: 决策引擎返回"maintain"
- **测试步骤**:
  1. 初始化Executor
  2. 调用execute("maintain")
- **预期结果**: 记录日志，不执行任何操作
- **优先级**: P0

#### TC-EXEC-002: 执行负载调整命令
- **前置条件**: 决策引擎返回"reduce_load"
- **测试步骤**:
  1. 初始化Executor
  2. 调用execute("reduce_load")
- **预期结果**: 向模拟器发送负载调整命令
- **优先级**: P0

#### TC-EXEC-003: 命令执行失败重试
- **前置条件**: 模拟器第一次调用失败
- **测试步骤**:
  1. 初始化Executor
  2. 模拟器第一次返回错误
  3. 调用execute("adjust_voltage")
- **预期结果**: 自动重试并成功执行
- **优先级**: P1

### 1.5 日志模块 (Logger)

#### TC-LOG-001: 记录INFO级别日志
- **前置条件**: 日志系统已初始化
- **测试步骤**:
  1. 调用logger.info("test message")
  2. 检查日志文件
- **预期结果**: 日志文件包含INFO级别的消息
- **优先级**: P2

#### TC-LOG-002: 记录ERROR级别日志
- **前置条件**: 日志系统已初始化
- **测试步骤**:
  1. 调用logger.error("error message")
  2. 检查日志文件
- **预期结果**: 日志文件包含ERROR级别的消息
- **优先级**: P1

#### TC-LOG-003: 日志轮转
- **前置条件**: 日志文件大小超过限制
- **测试步骤**:
  1. 写入大量日志直到超过大小限制
  2. 检查日志文件
- **预期结果**: 创建新的日志文件，旧文件被归档
- **优先级**: P2

## 2. 集成测试用例

### 2.1 端到端流程测试

#### TC-E2E-001: 完整控制循环
- **前置条件**: 所有模块正常运行
- **测试步骤**:
  1. 启动NanoGridBot
  2. 等待一个完整的控制周期
  3. 检查日志和模拟器状态
- **预期结果**:
  - 成功采集数据
  - 做出正确决策
  - 执行相应命令
  - 记录完整日志
- **优先级**: P0

#### TC-E2E-002: 异常恢复流程
- **前置条件**: 模拟器运行中断
- **测试步骤**:
  1. 启动NanoGridBot
  2. 中断模拟器连接
  3. 恢复模拟器连接
  4. 观察系统行为
- **预期结果**:
  - 检测到连接中断
  - 记录错误日志
  - 自动重连成功
  - 恢复正常运行
- **优先级**: P1

### 2.2 模块间交互测试

#### TC-INT-001: 配置更新传播
- **前置条件**: 系统正在运行
- **测试步骤**:
  1. 修改配置文件
  2. 重新加载配置
  3. 检查各模块是否使用新配置
- **预期结果**: 所有模块使用更新后的配置
- **优先级**: P1

#### TC-INT-002: 数据流转
- **前置条件**: 系统正在运行
- **测试步骤**:
  1. DataCollector采集数据
  2. 数据传递给DecisionEngine
  3. 决策结果传递给Executor
  4. 追踪数据流转过程
- **预期结果**: 数据在各模块间正确传递，无丢失或损坏
- **优先级**: P0

## 3. 性能测试用例

### 3.1 响应时间测试

#### TC-PERF-001: 控制循环响应时间
- **测试目标**: 验证控制循环在1秒内完成
- **测试步骤**:
  1. 启动NanoGridBot
  2. 记录100个控制周期的执行时间
  3. 计算平均响应时间
- **预期结果**: 平均响应时间 < 1秒
- **优先级**: P0

#### TC-PERF-002: 数据采集延迟
- **测试目标**: 验证数据采集延迟
- **测试步骤**:
  1. 记录1000次数据采集的时间
  2. 计算平均延迟
- **预期结果**: 平均延迟 < 100ms
- **优先级**: P1

### 3.2 资源使用测试

#### TC-PERF-003: 内存使用
- **测试目标**: 验证内存使用稳定
- **测试步骤**:
  1. 启动NanoGridBot
  2. 运行24小时
  3. 监控内存使用情况
- **预期结果**:
  - 内存使用 < 100MB
  - 无内存泄漏
- **优先级**: P1

#### TC-PERF-004: CPU使用率
- **测试目标**: 验证CPU使用合理
- **测试步骤**:
  1. 启动NanoGridBot
  2. 运行1小时
  3. 监控CPU使用率
- **预期结果**: 平均CPU使用率 < 10%
- **优先级**: P2

## 4. 压力测试用例

### 4.1 高负载测试

#### TC-STRESS-001: 连续运行测试
- **测试目标**: 验证长时间稳定运行
- **测试步骤**:
  1. 启动NanoGridBot
  2. 连续运行7天
  3. 监控系统状态
- **预期结果**:
  - 系统稳定运行
  - 无崩溃或异常
  - 日志正常记录
- **优先级**: P1

#### TC-STRESS-002: 快速决策切换
- **测试目标**: 验证频繁决策切换的稳定性
- **测试步骤**:
  1. 模拟电网状态快速变化
  2. 触发频繁的决策切换
  3. 运行1小时
- **预期结果**:
  - 系统正常响应
  - 无决策错误
  - 无命令丢失
- **优先级**: P1

## 5. 安全测试用例

### 5.1 输入验证测试

#### TC-SEC-001: 配置文件注入
- **测试目标**: 验证配置文件安全性
- **测试步骤**:
  1. 创建包含恶意代码的配置文件
  2. 尝试加载配置
- **预期结果**: 拒绝加载，抛出验证错误
- **优先级**: P0

#### TC-SEC-002: 命令注入防护
- **测试目标**: 验证命令执行安全性
- **测试步骤**:
  1. 尝试注入恶意命令
  2. 观察系统行为
- **预期结果**: 命令被拒绝，记录安全日志
- **优先级**: P0

### 5.2 权限测试

#### TC-SEC-003: 文件访问权限
- **测试目标**: 验证文件访问控制
- **测试步骤**:
  1. 尝试访问系统敏感文件
  2. 检查访问结果
- **预期结果**: 访问被拒绝
- **优先级**: P1

## 6. 兼容性测试用例

### 6.1 平台兼容性

#### TC-COMPAT-001: Linux平台测试
- **测试目标**: 验证Linux平台兼容性
- **测试步骤**:
  1. 在Ubuntu 20.04上部署
  2. 运行完整测试套件
- **预期结果**: 所有功能正常
- **优先级**: P0

#### TC-COMPAT-002: macOS平台测试
- **测试目标**: 验证macOS平台兼容性
- **测试步骤**:
  1. 在macOS 12+上部署
  2. 运行完整测试套件
- **预期结果**: 所有功能正常
- **优先级**: P1

#### TC-COMPAT-003: Windows平台测试
- **测试目标**: 验证Windows平台兼容性
- **测试步骤**:
  1. 在Windows 10+上部署
  2. 运行完整测试套件
- **预期结果**: 所有功能正常
- **优先级**: P2

### 6.2 Node.js版本兼容性

#### TC-COMPAT-004: Node.js 18.x测试
- **测试目标**: 验证Node.js 18.x兼容性
- **测试步骤**:
  1. 使用Node.js 18.x运行
  2. 执行完整测试
- **预期结果**: 所有功能正常
- **优先级**: P0

#### TC-COMPAT-005: Node.js 20.x测试
- **测试目标**: 验证Node.js 20.x兼容性
- **测试步骤**:
  1. 使用Node.js 20.x运行
  2. 执行完整测试
- **预期结果**: 所有功能正常
- **优先级**: P1

## 7. 回归测试用例

### 7.1 核心功能回归

#### TC-REG-001: 基本功能回归
- **测试目标**: 验证核心功能未被破坏
- **测试步骤**:
  1. 执行所有P0级别测试用例
  2. 检查测试结果
- **预期结果**: 所有P0测试通过
- **优先级**: P0
- **执行频率**: 每次代码提交

#### TC-REG-002: 完整功能回归
- **测试目标**: 验证所有功能正常
- **测试步骤**:
  1. 执行完整测试套件
  2. 检查测试结果
- **预期结果**: 所有测试通过或已知失败
- **优先级**: P1
- **执行频率**: 每次发布前

## 8. 用户验收测试用例

### 8.1 功能验收

#### TC-UAT-001: 基本使用场景
- **测试目标**: 验证基本使用流程
- **测试步骤**:
  1. 用户安装NanoGridBot
  2. 用户启动系统
  3. 用户观察运行状态
  4. 用户停止系统
- **预期结果**:
  - 安装简单
  - 启动顺利
  - 状态清晰
  - 停止正常
- **优先级**: P0

#### TC-UAT-002: 配置定制场景
- **测试目标**: 验证配置定制能力
- **测试步骤**:
  1. 用户修改配置文件
  2. 用户重启系统
  3. 用户验证配置生效
- **预期结果**:
  - 配置文件易于理解
  - 修改后正确生效
  - 错误提示清晰
- **优先级**: P0

## 测试优先级说明

- **P0**: 核心功能，必须通过
- **P1**: 重要功能，应该通过
- **P2**: 辅助功能，可以延后

## 测试环境要求

### 硬件要求
- CPU: 2核心以上
- 内存: 4GB以上
- 磁盘: 10GB可用空间

### 软件要求
- Node.js: 18.x或更高版本
- npm: 9.x或更高版本
- 操作系统: Linux/macOS/Windows

### 测试工具
- Jest: 单元测试框架
- Supertest: API测试工具
- Artillery: 性能测试工具
- ESLint: 代码质量检查

## 测试数据准备

### 正常数据集
```json
{
  "voltage": 220,
  "current": 10,
  "power": 2200,
  "frequency": 50,
  "load": 0.7
}
```

### 异常数据集
```json
{
  "voltage": 250,
  "current": 15,
  "power": 3750,
  "frequency": 48,
  "load": 0.95
}
```

### 边界数据集
```json
{
  "voltage": 198,
  "current": 0.1,
  "power": 19.8,
  "frequency": 49.5,
  "load": 0.01
}
```

## 测试执行计划

### 每日测试
- 执行所有单元测试
- 执行P0级别集成测试
- 生成测试报告

### 每周测试
- 执行完整测试套件
- 执行性能测试
- 执行安全测试
- 生成详细报告

### 发布前测试
- 执行完整回归测试
- 执行用户验收测试
- 执行兼容性测试
- 生成发布报告

## 缺陷管理

### 缺陷等级
- **Critical**: 系统崩溃、数据丢失
- **High**: 核心功能失效
- **Medium**: 功能部分失效
- **Low**: 界面问题、文档错误

### 缺陷处理流程
1. 发现缺陷 → 记录缺陷
2. 评估等级 → 分配责任人
3. 修复缺陷 → 验证修复
4. 关闭缺陷 → 更新文档
